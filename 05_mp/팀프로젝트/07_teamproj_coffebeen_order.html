<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메뉴 | 수제커피브루</title>
    <style>
        body {
            margin: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfcf7;
            color: #333;
        }
        header {
            background-color: #2d4739;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }
        nav a.active {
            font-weight: bold;
            text-decoration: underline;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        h2.section-title {
            color: #2d4739;
            text-align: center;
            margin-bottom: 40px;
        }
        .menu-grid, .menu-grid2 {
            display: grid;
	
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .menu-card, .menu-card2 {
            background-color: #fff;
	border:1px solid #2d4739;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
        }
        .menu-card img, .menu-card2 img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }
        .menu-card h3, .menu-card2 h3 {
            margin: 10px 0;
            color: #2d4739;
        }
        .menu-card p, .menu-card2 p {
            margin: 5px 0;
            color: #e67e22;
            font-weight: bold;
        }
         .menu-card:hover,
        .menu-card2:hover {
            transform: translateY(-5px);
        }
        .btn {
            background-color: #2d4739;
            color: #fdfcf7;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .btn:hover {
            background-color: #1f3128;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #fdfcf7;
            padding: 15px;
            border-radius: 10px;
            max-width: 400px;
            width: 85%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        .modal-content h3 {
            margin: 0 0 10px;
            color: #2d4739;
            font-size: 1.2em;
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 0.9em;
        }
        .form-group .error {
            color: #e67e22;
            font-size: 0.8em;
            display: none;
        }
        .options-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .options-group label {
            display: inline;
            margin-right: 5px;
        }
        .options-group input[type="radio"], .options-group input[type="checkbox"] {
            width: auto;
            vertical-align: middle;
        }
        .inline-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .cart-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-item-details {
            flex: 1;
        }
        .cart-item-actions {
            display: flex;
            gap: 5px;
        }
        .total-section {
            margin: 10px 0;
            font-size: 0.9em;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        footer {
            background-color: #2d4739;
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }
        @media (max-width: 768px) {
            .modal-content {
                max-width: 320px;
            }
            .options-group, .inline-group {
                grid-template-columns: 1fr;
            }
            .menu-grid, .menu-grid2 {
                grid-template-columns: 1fr;
            }
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>수제커피브루</h1>
        <nav>            
            <a href="./07_teamproj_index.html">홈</a>
            <a href="./07_teamproj_submenu.html">메뉴</a>
            <a href="./07_teamproj_menu_order.html" class="active">주문하기</a>
            <a href="./07_teamproj_findstore.html">매장 찾기</a>
            <a href="./07_teamproj_order_page.html">배송현황</a>
            <a href="./07_teamproj_order_tracking.html" >주문조회</a>
            <a href="./07_teamproj_login.html">로그인</a>
            <a href="./07_teamproj_join_page.html">회원 가입</a>
            <a href="./07_teamproj_board.html">자유 게시판</a>
            <span class="cart-icon">장바구니🛒<span class="cart-count">0</span></span>
        </nav>
    </header>

    <div class="container">
        <h2 class="section-title">우리의 인기 커피 메뉴</h2>
        <div class="menu-grid">
            <div class="menu-card">
                <img src="./02_CSS/img/bg_tree.png" alt="브루드 아메리카노">
                <h3>브루드 아메리카노</h3>
                <p>₩4,000</p>
                <button class="btn" onclick="openAddToCartModal('브루드 아메리카노', 4000)">장바구니에 추가</button>
            </div>
            <div class="menu-card">
                <img src="./02_CSS/img/bg_tree.png" alt="핸드드립 콜드브루">
                <h3>핸드드립 콜드브루</h3>
                <p>₩4,500</p>
                <button class="btn" onclick="openAddToCartModal('핸드드립 콜드브루', 4500)">장바구니에 추가</button>
            </div>
            <div class="menu-card">
                <img src="./02_CSS/img/bg_tree.png" alt="시그니처 라떼">
                <h3>시그니처 라떼</h3>
                <p>₩5,000</p>
                <button class="btn" onclick="openAddToCartModal('시그니처 라떼', 5000)">장바구니에 추가</button>
            </div>
            <div class="menu-card">
                <img src="./02_CSS/img/bg_tree.png" alt="밀크 라떼">
                <h3>밀크 라떼</h3>
                <p>₩6,000</p>
                <button class="btn" onclick="openAddToCartModal('밀크 라떼', 6000)">장바구니에 추가</button>
            </div>
        </div>
        <h2 class="section-title">시즌 기념 한정 메뉴</h2>
        <div class="menu-grid2">
            <div class="menu-card2">
                <img src="./02_CSS/img/bg_tree.png" alt="브루드 아메리카노">
                <h3>브루드 아메리카노</h3>
                <p>₩4,000</p>
                <button class="btn" onclick="openAddToCartModal('브루드 아메리카노', 4000)">장바구니에 추가</button>
            </div>
            <div class="menu-card2">
                <img src="./02_CSS/img/bg_tree.png" alt="핸드드립 콜드브루">
                <h3>핸드드립 콜드브루</h3>
                <p>₩4,500</p>
                <button class="btn" onclick="openAddToCartModal('핸드드립 콜드브루', 4500)">장바구니에 추가</button>
            </div>
            <div class="menu-card2">
                <img src="./02_CSS/img/bg_tree.png" alt="시그니처 라떼">
                <h3>시그니처 라떼</h3>
                <p>₩5,000</p>
                <button class="btn" onclick="openAddToCartModal('시그니처 라떼', 5000)">장바구니에 추가</button>
            </div>
            <div class="menu-card2">
                <img src="./02_CSS/img/bg_tree.png" alt="에스프레쏘">
                <h3>에스프레쏘</h3>
                <p>₩6,000</p>
                <button class="btn" onclick="openAddToCartModal('에스프레쏘', 6000)">장바구니에 추가</button>
            </div>
        </div>
    </div>

    <!-- 주문 추가 모달 -->
    <div class="modal" id="add-to-cart-modal">
        <div class="modal-content">
            <h3 id="modal-item-name"></h3>
            <p>가격: ₩<span id="modal-item-price"></span></p>
            <div class="form-group options-group">
                <div>
                    <label>온도</label>
                    <input type="radio" name="temp" value="hot" checked> 핫
                    <input type="radio" name="temp" value="ice"> 아이스
                </div>
                <div>
                    <label>샷 추가 (₩500)</label>
                    <input type="checkbox" id="extra-shot">
                </div>
                <div>
                    <label>시럽 추가 (₩500)</label>
                    <select id="syrup">
                        <option value="none">없음</option>
                        <option value="vanilla">바닐라</option>
                        <option value="caramel">캐러멜</option>
                    </select>
                </div>
                <div>
                    <label for="quantity">수량</label>
                    <input type="number" id="quantity" min="1" value="1">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="addToCart()">장바구니에 추가</button>
                <button class="btn" onclick="closeAddToCartModal()">닫기</button>
            </div>
        </div>
    </div>

    <!-- 장바구니 모달 -->
    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <h3>장바구니</h3>
            <div id="cart-items"></div>
            <div class="total-section">
                총액: ₩<span id="cart-total">0</span> (배송비: ₩<span id="cart-shipping">0</span>)
            </div>
            <div class="form-group inline-group">
                <div>
                    <label for="cart-name">이름</label>
                    <input type="text" id="cart-name" placeholder="이름">
                    <span class="error" id="cart-name-error">이름을 2자 이상 입력해주세요.</span>
                </div>
                <div>
                    <label for="cart-phone">연락처</label>
                    <input type="text" id="cart-phone" placeholder="010-1234-5678">
                    <span class="error" id="cart-phone-error">유효한 연락처를 입력해주세요.</span>
                </div>
            </div>
            <div class="form-group">
                <label for="cart-address">배송지 주소</label>
                <input type="text" id="cart-address" placeholder="주소">
                <span class="error" id="cart-address-error">주소를 5자 이상 입력해주세요.</span>
            </div>
            <div class="form-group">
                <label for="cart-payment">결제 수단</label>
                <select id="cart-payment">
                    <option value="card">신용카드</option>
                    <option value="mobile">간편결제</option>
                </select>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="submitOrder()">결제하기</button>
                <button class="btn" onclick="closeCartModal()">닫기</button>
            </div>
        </div>
    </div>

    <footer>
        © 2025 수제커피브루 | 경기도 커피시 향기구 아라비카로 100
    </footer>

    <script>
        let currentItem = null;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function openAddToCartModal(name, basePrice) {
            currentItem = { name, basePrice };
            document.getElementById('modal-item-name').textContent = name;
            document.getElementById('modal-item-price').textContent = basePrice;
            document.getElementById('quantity').value = 1;
            document.getElementById('extra-shot').checked = false;
            document.getElementById('syrup').value = 'none';
            document.querySelector('input[name="temp"][value="hot"]').checked = true;
            document.getElementById('add-to-cart-modal').style.display = 'flex';
        }

        function closeAddToCartModal() {
            document.getElementById('add-to-cart-modal').style.display = 'none';
            currentItem = null;
        }

        function addToCart() {
            const item = {
                itemId: 'ITEM' + Date.now(),
                name: currentItem.name,
                basePrice: currentItem.basePrice,
                temp: document.querySelector('input[name="temp"]:checked').value,
                extraShot: document.getElementById('extra-shot').checked,
                syrup: document.getElementById('syrup').value,
                quantity: parseInt(document.getElementById('quantity').value) || 1
            };
            cart.push(item);
            localStorage.setItem('cart', JSON.stringify(cart));
            alert(`${item.name}이(가) 장바구니에 추가되었습니다.`);
            closeAddToCartModal();
            openCartModal();
        }

        function openCartModal() {
            displayCartItems();
            document.getElementById('cart-modal').style.display = 'flex';
        }

        function closeCartModal() {
            document.getElementById('cart-modal').style.display = 'none';
            document.querySelectorAll('.error').forEach(e => e.style.display = 'none');
        }

        function displayCartItems() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            let subtotal = 0;
            cart.forEach(item => {
                let price = item.basePrice;
                if (item.extraShot) price += 500;
                if (item.syrup !== 'none') price += 500;
                const itemTotal = price * item.quantity;
                subtotal += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-details">
                        <strong>${item.name}</strong><br>
                        온도: ${item.temp}, 샷 추가: ${item.extraShot ? '예' : '아니오'}, 
                        시럽: ${item.syrup === 'none' ? '없음' : item.syrup}<br>
                        수량: <input type="number" min="1" value="${item.quantity}" onchange="updateCartItemQuantity('${item.itemId}', this.value)">
                        가격: ₩${itemTotal}
                    </div>
                    <div class="cart-item-actions">
                        <button class="btn" onclick="removeCartItem('${item.itemId}')">삭제</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });

            const shipping = subtotal >= 30000 ? 0 : 3000;
            document.getElementById('cart-total').textContent = subtotal + shipping;
            document.getElementById('cart-shipping').textContent = shipping;
        }

        function updateCartItemQuantity(itemId, quantity) {
            const item = cart.find(i => i.itemId === itemId);
            if (item) {
                item.quantity = parseInt(quantity) || 1;
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCartItems();
            }
        }

        function removeCartItem(itemId) {
            cart = cart.filter(i => i.itemId !== itemId);
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCartItems();
        }

        function validateOrderForm() {
            const name = document.getElementById('cart-name').value.trim();
            const address = document.getElementById('cart-address').value.trim();
            const phone = document.getElementById('cart-phone').value.trim();
            let isValid = true;

            document.querySelectorAll('.error').forEach(e => e.style.display = 'none');

            if (cart.length === 0) {
                alert('장바구니가 비어 있습니다.');
                return false;
            }
            if (name.length < 2) {
                document.getElementById('cart-name-error').style.display = 'block';
                isValid = false;
            }
            if (address.length < 5) {
                document.getElementById('cart-address-error').style.display = 'block';
                isValid = false;
            }
            if (!/^\d{3}-\d{4}-\d{4}$/.test(phone)) {
                document.getElementById('cart-phone-error').style.display = 'block';
                isValid = false;
            }
            return isValid;
        }

        async function submitOrder() {
            if (!validateOrderForm()) return;

            const items = cart.map(item => ({
                name: item.name,
                price: item.basePrice + (item.extraShot ? 500 : 0) + (item.syrup !== 'none' ? 500 : 0),
                quantity: item.quantity,
                temp: item.temp,
                extraShot: item.extraShot,
                syrup: item.syrup
            }));
            const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const shipping = subtotal >= 30000 ? 0 : 3000;
            const order = {
                items,
                name: document.getElementById('cart-name').value.trim(),
                address: document.getElementById('cart-address').value.trim(),
                phone: document.getElementById('cart-phone').value.trim(),
                payment: document.getElementById('cart-payment').value,
                subtotal,
                shipping,
                total: subtotal + shipping,
                orderId: 'ORD' + Date.now(),
                status: '주문 접수',
                createdAt: new Date().toISOString()
            };

            // Toss Payments API 호출 (모의)
            try {
                // 실제 API 호출 예시 (키 필요)
                /*
                const response = await fetch('https://api.tosspayments.com/v1/payments', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic YOUR_TOSS_API_KEY',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: order.total,
                        orderId: order.orderId,
                        orderName: '수제커피브루 주문',
                        customerName: order.name
                    })
                });
                const result = await response.json();
                if (!result.success) throw new Error('결제 실패');
                */

                // 모의 결제
                console.log('Toss Payments API 호출 시뮬레이션:', {
                    amount: order.total,
                    orderId: order.orderId,
                    orderName: '수제커피브루 주문',
                    customerName: order.name
                });

                // 주문 저장
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));

                // 장바구니 초기화
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));

                alert(`결제 완료! 주문 번호: ${order.orderId}\n총액: ₩${order.total}`);
                closeCartModal();
                window.location.href = './07_teamproj_order_page.html';
            } catch (error) {
                console.error('결제 오류:', error);
                alert('결제에 실패했습니다. 다시 시도해주세요.');
            }
        }

        document.getElementById('quantity').addEventListener('input', () => {
            document.getElementById('quantity').value = Math.max(1, parseInt(document.getElementById('quantity').value) || 1);
        });
        document.getElementById('extra-shot').addEventListener('change', () => {});
        document.getElementById('syrup').addEventListener('change', () => {});
        document.querySelectorAll('input[name="temp"]').forEach(radio => radio.addEventListener('change', () => {}));

        document.getElementById('cart-phone').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') submitOrder();
        });
    </script>
</body>
</html>