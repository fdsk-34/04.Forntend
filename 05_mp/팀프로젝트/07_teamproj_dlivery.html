<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°°ì†¡í˜„í™© | ìˆ˜ì œì»¤í”¼ë¸Œë£¨</title>
    <style>
        body {
            margin: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fff;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #2d4739;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }
        nav a.active {
            font-weight: bold;
            text-decoration: underline;
        }
        main {
            flex: 1;
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #719CED;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.8rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #fdfcf7;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }
        .search-box {
            max-width: 1350px;
            margin-bottom: 40px;
        }
        .search-box .input-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .search-box input, .search-box select {
            padding: 10px;
            font-size: 0.9em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .search-box input {
            width: 400px;
            height: 40px;
        }
        .search-box select {
            width: 200px;
            height: 40px;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            height: 40px;
        }
        .search-box button {
            width: 100px;
            font-size: 0.9em;
            line-height: 40px;
            border: none;
            border-radius: 5px;
            background-color: #2d4739;
            color: #fdfcf7;
            cursor: pointer;
            padding: 0;
        }
        .search-box button:hover {
            background-color: #1f3128;
        }
        .search-box .error {
            color: #e67e22;
            font-size: 0.8em;
            margin-top: 5px;
            display: none;
            width: 100%;
        }
        .image-container {
            width: 100%;
            height: 200px;
            margin-top: 20px;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
        }
        .no-order {
            background-color: #fdfcf7;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            display: none;
        }
        .order-details-panel {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background-color: #fdfcf7;
            border-left: 1px solid #ccc;
            box-shadow: -2px 0 8px rgba(0,0,0,0.1);
            padding: 20px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            overflow-y: auto;
        }
        .order-details-panel.open {
            display: block;
            transform: translateX(0);
        }
        .order-details-panel select {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .order-details {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .order-details h3 {
            color: #2d4739;
            margin-top: 0;
        }
        .order-items {
            margin: 20px 0;
        }
        .order-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .status-timeline {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .status-step {
            text-align: center;
            flex: 1;
            position: relative;
        }
        .status-step.active {
            font-weight: bold;
            color: #2d4739;
        }
        .status-step::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: #ccc;
            border-radius: 50%;
            transform: translateX(-50%);
        }
        .status-step.active::before {
            background-color: #2d4739;
        }
        .btn.cancel-btn {
            background-color: #e67e22;
            color: #fff;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            width: 100%;
        }
        .btn.cancel-btn:hover {
            background-color: #d35400;
        }
        .btn.cancel-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .btn.close-btn {
            display: block;
            margin: 10px auto;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #2d4739;
            padding: 10px;
            min-height: 44px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .sidebar-panel {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: #fdfcf7;
            border-left: 1px solid #ccc;
            box-shadow: -2px 0 8px rgba(0,0,0,0.1);
            padding: 20px;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-panel.open {
            display: block;
            transform: translateX(0);
        }
        .sidebar-panel-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .sidebar-panel-content p {
            margin: 0 0 20px;
            font-size: 1em;
            color: #333;
        }
        .sidebar-panel-content .btn-group {
            margin-top: auto;
            display: flex;
            gap: 10px;
        }
        .sidebar-panel-content button {
            flex: 1;
            padding: 10px;
        }
        footer {
            background-color: #2d4739;
            color: #fdfcf7;
            padding: 20px;
            text-align: center;
            width: 100%;
        }
        @media (max-width: 768px) {
            main {
                padding: 0 10px;
            }
            .search-box {
                max-width: 100%;
            }
            .search-box .input-group {
                flex-direction: column;
            }
            .search-box input, .search-box select, .search-box .btn-group {
                width: 100%;
            }
            .search-box button {
                width: 100%;
                line-height: normal;
                padding: 10px;
            }
            .image-container {
                height: 150px;
            }
            .status-timeline {
                flex-direction: column;
                gap: 10px;
            }
            .status-step::before {
                top: 0;
                left: -10px;
                transform: none;
            }
            .order-details-panel {
                width: 100%;
                max-width: none;
            }
            .sidebar-panel {
                width: 100%;
                max-width: none;
            }
            .sidebar-panel-content .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ìˆ˜ì œì»¤í”¼ë¸Œë£¨</h1>
       <nav>            
            <a href="./07_teamproj_index.html" >í™ˆ</a>
            <a href="./07_teamproj_submenu.html">ë©”ë‰´</a>
            <a href="./07_teamproj_findstore.html">ë§¤ì¥ ì°¾ê¸°</a>
            <a href="./07_teamproj_dlivery.html" class="active">ë°°ì†¡í˜„í™©</a>
            <a href="./07_teamproj_order_tracking.html" >ì£¼ë¬¸ì¡°íšŒ</a>
            <a href="./07_teamproj_login.html">ë¡œê·¸ì¸</a>
            <a href="./07_teamproj_join_page.html">íšŒì› ê°€ì…</a>
            <a href="./07_teamproj_board.html">ììœ  ê²Œì‹œíŒ</a>
            <span class="cart-icon">ì¥ë°”êµ¬ë‹ˆğŸ›’<span class="cart-count">0</span></span>
        </nav>
    </header>

    <main>
        <h2 style="color: #2d4739; margin-bottom: 20px;">ë°°ì†¡í˜„í™© ì¡°íšŒ</h2>
        <div class="search-box">
            <div class="input-group">
                <input type="text" id="order-id" placeholder="ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ORD123456789,ORD987654321)">
                <select id="search-history" onchange="selectSearchHistory()">
                    <option value="">ìµœê·¼ ì¡°íšŒ ê¸°ë¡</option>
                </select>
                <select id="sort-order">
                    <option value="latest">ìµœì‹ ìˆœ</option>
                    <option value="total-asc">ì´ì•¡ ë‚®ì€ìˆœ</option>
                    <option value="total-desc">ì´ì•¡ ë†’ì€ìˆœ</option>
                </select>
                <select id="status-filter">
                    <option value="" selected>ì „ì²´</option>
                    <option value="ì£¼ë¬¸ ì ‘ìˆ˜">ì£¼ë¬¸ ì ‘ìˆ˜</option>
                    <option value="ë°°ì†¡ ì¤€ë¹„">ë°°ì†¡ ì¤€ë¹„</option>
                    <option value="ë°°ì†¡ ì¤‘">ë°°ì†¡ ì¤‘</option>
                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                    <option value="ì·¨ì†Œë¨">ì·¨ì†Œë¨</option>
                </select>
                <div class="btn-group">
                    <button class="btn" onclick="trackOrder()">ì¡°íšŒ</button>
                    <button class="btn" onclick="resetSearch()">ì·¨ì†Œ</button>
                    <button class="btn" onclick="clearSearchHistory()">ì¡°íšŒ ê¸°ë¡ ì‚­ì œ</button>
                </div>
            </div>
            <span class="error" id="order-id-error"></span>
            <div class="image-container">
                <!-- ì´ë¯¸ì§€ ì‚½ì… ê³µê°„ -->
                <p>ì´ë¯¸ì§€ ì‚½ì… ê³µê°„</p>
            </div>
        </div>
        <div class="no-order" id="no-order">
            <p>ì¡°íšŒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </main>

    <div class="modal-overlay" id="modal-overlay" onclick="closeOrderPanel()"></div>
    <div class="order-details-panel" id="order-details-panel">
        <select id="order-select" onchange="displayOrderDetails(this.value)">
            <option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>
        </select>
        <div id="order-details-content"></div>
    </div>
    <div class="sidebar-panel" id="cancel-panel">
        <div class="sidebar-panel-content">
            <p id="cancel-message"></p>
            <div class="btn-group">
                <button class="btn" onclick="confirmCancel()">í™•ì¸</button>
                <button class="btn" onclick="closeCancelPanel()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <footer>
        Â© 2025 ìˆ˜ì œì»¤í”¼ë¸Œë£¨ | ê²½ê¸°ë„ ì»¤í”¼ì‹œ í–¥ê¸°êµ¬ ì•„ë¼ë¹„ì¹´ë¡œ 100
    </footer>

    <script>
        // ì¡°íšŒ ê¸°ë¡ ë¡œë“œ
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
        let currentOrders = [];
        updateSearchHistoryDropdown();

        function updateSearchHistoryDropdown() {
            const historySelect = document.getElementById('search-history');
            historySelect.innerHTML = '<option value="">ìµœê·¼ ì¡°íšŒ ê¸°ë¡</option>';
            searchHistory.forEach(history => {
                historySelect.innerHTML += `<option value="${history.orderId}">${history.orderId}</option>`;
            });
        }

        function saveSearchHistory(orderIds) {
            orderIds.forEach(orderId => {
                searchHistory = searchHistory.filter(h => h.orderId !== orderId);
                searchHistory.unshift({ orderId, timestamp: new Date().toISOString() });
            });
            if (searchHistory.length > 5) {
                searchHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                searchHistory = searchHistory.slice(0, 5);
            }
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            updateSearchHistoryDropdown();
        }

        function clearSearchHistory() {
            searchHistory = [];
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            updateSearchHistoryDropdown();
            alert('ì¡°íšŒ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function selectSearchHistory() {
            const historySelect = document.getElementById('search-history');
            if (historySelect.value) {
                document.getElementById('order-id').value = historySelect.value;
            }
        }

        function resetSearch() {
            document.getElementById('order-id').value = '';
            document.getElementById('sort-order').value = 'latest';
            document.getElementById('status-filter').value = '';
            document.getElementById('order-id-error').style.display = 'none';
            document.getElementById('no-order').style.display = 'none';
            closeOrderPanel();
        }

        function openOrderPanel() {
            document.getElementById('modal-overlay').style.display = 'block';
            document.getElementById('order-details-panel').classList.add('open');
        }

        function closeOrderPanel() {
            document.getElementById('order-details-panel').classList.remove('open');
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('order-select').innerHTML = '<option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('order-details-content').innerHTML = '';
            currentOrders = [];
        }

        function displayOrderDetails(orderId) {
            const order = currentOrders.find(o => o.orderId === orderId);
            if (!order) return;
            const content = document.getElementById('order-details-content');
            content.innerHTML = `
                <div class="order-details">
                    <h3>ì£¼ë¬¸ ì •ë³´</h3>
                    <p><strong>ì£¼ë¬¸ ë²ˆí˜¸:</strong> <span>${order.orderId}</span></p>
                    <p><strong>ë°°ì†¡ì§€:</strong> <span>${order.address}</span></p>
                    <p><strong>ì—°ë½ì²˜:</strong> <span>${order.phone}</span></p>
                    <p><strong>ê²°ì œ ìˆ˜ë‹¨:</strong> <span>${order.payment === 'card' ? 'ì‹ ìš©ì¹´ë“œ' : 'ê°„í¸ê²°ì œ'}</span></p>
                    <p><strong>ì´ì•¡:</strong> â‚©<span>${order.total}</span></p>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div class="order-item">
                                <p>${item.name} (${item.temp}, ${item.extraShot ? 'ìƒ· ì¶”ê°€, ' : ''}${item.syrup !== 'none' ? item.syrup + ' ì‹œëŸ½' : ''}) 
                                - â‚©${item.price} x ${item.quantity}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="status-timeline">
                        <div class="status-step ${order.status === 'ì£¼ë¬¸ ì ‘ìˆ˜' ? 'active' : ''}" data-status="ì£¼ë¬¸ ì ‘ìˆ˜">ì£¼ë¬¸ ì ‘ìˆ˜</div>
                        <div class="status-step ${order.status === 'ë°°ì†¡ ì¤€ë¹„' ? 'active' : ''}" data-status="ë°°ì†¡ ì¤€ë¹„">ë°°ì†¡ ì¤€ë¹„</div>
                        <div class="status-step ${order.status === 'ë°°ì†¡ ì¤‘' ? 'active' : ''}" data-status="ë°°ì†¡ ì¤‘">ë°°ì†¡ ì¤‘</div>
                        <div class="status-step ${order.status === 'ì™„ë£Œ' ? 'active' : ''}" data-status="ì™„ë£Œ">ì™„ë£Œ</div>
                        <div class="status-step ${order.status === 'ì·¨ì†Œë¨' ? 'active' : ''}" data-status="ì·¨ì†Œë¨">ì·¨ì†Œë¨</div>
                    </div>
                    <button class="btn cancel-btn" ${order.status !== 'ì£¼ë¬¸ ì ‘ìˆ˜' ? 'disabled' : ''} onclick="openCancelPanel('${order.orderId}')">ì·¨ì†Œ</button>
                    <button class="btn close-btn" onclick="closeOrderPanel()">ë‹«ê¸°</button>
                </div>
            `;
        }

        function trackOrder() {
            const orderIdInput = document.getElementById('order-id').value.trim();
            const sortOrder = document.getElementById('sort-order').value;
            const statusFilter = document.getElementById('status-filter').value;
            const orderIdError = document.getElementById('order-id-error');
            const noOrder = document.getElementById('no-order');

            // ì´ˆê¸°í™”
            orderIdError.style.display = 'none';
            noOrder.style.display = 'none';
            closeOrderPanel();

            // ì£¼ë¬¸ ë²ˆí˜¸ íŒŒì‹±
            const orderIds = orderIdInput ? orderIdInput.split(',').map(id => id.trim()).filter(id => id) : [];
            const invalidIds = orderIds.filter(id => !/^ORD\d+$/.test(id));

            // ìœ íš¨ì„± ê²€ì‚¬
            if (orderIds.length === 0 && statusFilter === '') {
                orderIdError.textContent = 'ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
                orderIdError.style.display = 'block';
                return;
            }
            if (invalidIds.length > 0) {
                orderIdError.textContent = `ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ë¬¸ ë²ˆí˜¸: ${invalidIds.join(', ')}`;
                orderIdError.style.display = 'block';
                return;
            }

            // ì£¼ë¬¸ ì¡°íšŒ
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            let filteredOrders = orders;

            // ìƒíƒœ í•„í„° ì ìš©
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(o => o.status === statusFilter);
            }

            // ì£¼ë¬¸ ë²ˆí˜¸ í•„í„° ì ìš©
            if (orderIds.length > 0) {
                filteredOrders = filteredOrders.filter(o => orderIds.includes(o.orderId));
            }

            if (filteredOrders.length === 0) {
                noOrder.style.display = 'block';
                return;
            }

            // ì¡°íšŒ ê¸°ë¡ ì €ì¥
            if (orderIds.length > 0) {
                saveSearchHistory(orderIds);
            }

            // ì •ë ¬
            filteredOrders.sort((a, b) => {
                if (sortOrder === 'total-asc') return a.total - b.total;
                if (sortOrder === 'total-desc') return b.total - a.total;
                return new Date(b.createdAt) - new Date(a.createdAt); // latest
            });

            // ì£¼ë¬¸ íŒ¨ë„ í‘œì‹œ
            currentOrders = filteredOrders;
            const orderSelect = document.getElementById('order-select');
            orderSelect.innerHTML = '<option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            filteredOrders.forEach(order => {
                orderSelect.innerHTML += `<option value="${order.orderId}">${order.orderId}</option>`;
            });
            if (filteredOrders.length > 0) {
                orderSelect.value = filteredOrders[0].orderId;
                displayOrderDetails(filteredOrders[0].orderId);
                openOrderPanel();
            }
        }

        function openCancelPanel(orderId) {
            document.getElementById('cancel-message').textContent = `ì£¼ë¬¸ ë²ˆí˜¸ ${orderId}ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            document.getElementById('cancel-panel').dataset.orderId = orderId;
            document.getElementById('modal-overlay').style.display = 'block';
            document.getElementById('cancel-panel').classList.add('open');
        }

        function closeCancelPanel() {
            document.getElementById('cancel-panel').classList.remove('open');
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('cancel-panel').dataset.orderId = '';
        }

        function confirmCancel() {
            const orderId = document.getElementById('cancel-panel').dataset.orderId;
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders.find(o => o.orderId === orderId);
            if (order && order.status === 'ì£¼ë¬¸ ì ‘ìˆ˜') {
                order.status = 'ì·¨ì†Œë¨';
                localStorage.setItem('orders', JSON.stringify(orders));
                alert(`ì£¼ë¬¸ ë²ˆí˜¸ ${orderId}ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                closeCancelPanel();
                trackOrder();
            }
        }

        // Enter í‚¤ë¡œ ì¡°íšŒ
        document.getElementById('order-id').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') trackOrder();
        });
    </script>
</body>
</html>